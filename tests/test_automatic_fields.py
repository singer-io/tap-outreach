from tap_tester.base_suite_tests.automatic_fields_test import MinimumSelectionTest
from base import OutreachBase


class OutreachMinimumSelectionTest(MinimumSelectionTest, OutreachBase):
    """Standard Automatic Fields Test"""

    @staticmethod
    def name():
        return "tt_outreach_auto"
    
    def streams_to_test(self):
        streams_to_exclude = {'mailings', 'duties', 'users', 'sequence_states', 'sequences'}
        return self.expected_stream_names().difference(streams_to_exclude)

    def expected_automatic_fields(self, stream=None):
        """
        return a dictionary with key of table name
        and value as a set of automatic fields
        """
        MISSING_FIELDS = {
            "call_dispositions": {
                'outcome',
                'createdAt',
                'name',
                'order',
                'creatorId',
            },
            "mailboxes": {
                'optOutSignature',
                'emailSignature',
                'syncActiveFrequency',
                'sendPeriod',
                'syncFinishedAt',
                'syncSuccessAt',
                'sendDisabled',
                'createdAt',
                'syncErroredAt',
                'ewsSslVerifyMode',
                'imapPort',
                'smtpSsl',
                'syncOutreachFolder',
                'prospectEmailExclusions',
                'ewsEndpoint',
                'creatorId',
                'optOutMessage',
                'sendRequiresSync',
                'sendErroredAt',
                'sendMethod',
                'username',
                'maxMailingsPerWeek',
                'authId',
                'syncMethod',
                'emailProvider',
                'smtpHost',
                'smtpUsername',
                'emailHash',
                'email',
                'providerId',
                'editable',
                'syncDisabled',
                'imapSsl',
                'sendThreshold',
                'sendgridWebhookUrl',
                'updaterId',
                'providerType',
                'sendSuccessAt',
                'userId',
                'maxMailingsPerDay',
                'imapHost',
                'maxEmailsPerDay',
                'smtpPort',
                'exchangeVersion',
                'syncPassiveFrequency',
                'sendMaxRetries',
            },
            "personas": {
                'createdAt',
                'name',
                'description',
            },
            "teams": {
                'color',
                'scimExternalId',
                'scimSource',
                'updaterId',
                'createdAt',
                'name',
                'creatorId',
            },
            "tasks": {
                'subjectId',
                'completed',
                'createdAt',
                'sequenceStateId',
                'action',
                'opportunityId',
                'sequenceId',
                'completedAt',
                'sequenceTemplateId',
                'dueAt',
                'mailingId',
                'creatorId',
                'scheduledAt',
                'note',
                'completerId',
                'prospectId',
                'stateChangedAt',
                'templateId',
                'opportunityAssociation',
                'accountId',
                'taskType',
                'sequenceStepId',
                'state',
                'autoskipAt',
                'compiledSequenceTemplateHtml',
                'callId',
                'ownerId',
                'taskPriorityId',
            },
            "sequence_templates": {
                'neutralReplyCount',
                'updaterId',
                'replyCount',
                'createdAt',
                'isReply',
                'scheduleCount',
                'enabled',
                'optOutCount',
                'creatorId',
                'positiveReplyCount',
                'deliverCount',
                'clickCount',
                'templateId',
                'sequenceStepId',
                'enabledAt',
                'bounceCount',
                'openCount',
                'failureCount',
            },
            "opportunities": {
                'custom35',
                'custom124',
                'custom78',
                'custom122',
                'custom136',
                'custom116',
                'custom53',
                'custom11',
                'custom95',
                'custom131',
                'custom96',
                'probability',
                'custom147',
                'custom61',
                'custom15',
                'prospectingRepId',
                'custom8',
                'custom130',
                'custom88',
                'ownerId',
                'custom7',
                'touchedAt',
                'sharingTeamId',
                'custom104',
                'custom103',
                'custom4',
                'custom49',
                'custom12',
                'custom69',
                'custom17',
                'custom59',
                'nextStep',
                'name',
                'custom10',
                'custom67',
                'custom66',
                'description',
                'custom85',
                'custom47',
                'custom60',
                'custom126',
                'accountId',
                'custom138',
                'amount',
                'tags',
                'custom117',
                'custom113',
                'custom128',
                'custom134',
                'custom133',
                'custom41',
                'custom135',
                'custom83',
                'custom77',
                'custom48',
                'custom148',
                'custom114',
                'custom145',
                'custom9',
                'custom110',
                'custom107',
                'custom139',
                'custom68',
                'custom105',
                'custom97',
                'custom81',
                'custom71',
                'custom143',
                'custom27',
                'custom45',
                'custom79',
                'custom123',
                'custom101',
                'custom65',
                'stageId',
                'currencyType',
                'custom31',
                'custom86',
                'custom36',
                'custom14',
                'custom140',
                'custom119',
                'custom62',
                'custom100',
                'custom144',
                'custom46',
                'custom93',
                'custom25',
                'custom16',
                'custom129',
                'custom18',
                'createdAt',
                'custom23',
                'creatorId',
                'custom98',
                'custom75',
                'custom30',
                'custom74',
                'custom55',
                'custom80',
                'custom64',
                'mapStatus',
                'custom56',
                'custom13',
                'custom92',
                'custom109',
                'custom108',
                'custom94',
                'custom73',
                'custom150',
                'custom84',
                'custom32',
                'custom82',
                'custom99',
                'custom115',
                'custom91',
                'custom34',
                'externalCreatedAt',
                'custom120',
                'custom141',
                'closeDate',
                'custom58',
                'custom102',
                'custom38',
                'custom63',
                'mapLink',
                'custom118',
                'custom37',
                'custom22',
                'custom19',
                'custom52',
                'custom137',
                'opportunityStageId',
                'custom6',
                'custom40',
                'custom54',
                'custom112',
                'custom146',
                'custom28',
                'custom127',
                'custom29',
                'custom42',
                'custom106',
                'custom125',
                'custom50',
                'custom21',
                'custom57',
                'custom72',
                'custom132',
                'custom44',
                'custom121',
                'custom87',
                'updaterId',
                'custom3',
                'custom5',
                'custom70',
                'custom1',
                'custom24',
                'custom149',
                'custom26',
                'custom20',
                'custom39',
                'custom33',
                'mapNextSteps',
                'custom142',
                'custom2',
                'custom111',
                'custom43',
                'custom76',
                'opportunityType',
                'custom90',
                'custom89',
                'custom51',
            },
            "content_categories": {
                'color',
                'allowSnippets',
                'createdAt',
                'allowSequences',
                'name',
                'allowTemplates',
                'creatorId',
            },
            "accounts": {
                'custom35',
                'custom124',
                'custom78',
                'custom122',
                'custom136',
                'custom116',
                'custom53',
                'custom11',
                'custom95',
                'custom131',
                'custom96',
                'custom147',
                'custom61',
                'custom15',
                'custom8',
                'custom130',
                'custom88',
                'ownerId',
                'custom7',
                'touchedAt',
                'sharingTeamId',
                'custom104',
                'custom103',
                'numberOfEmployees',
                'custom4',
                'custom49',
                'custom12',
                'custom69',
                'industry',
                'custom17',
                'custom59',
                'custom10',
                'name',
                'custom67',
                'companyType',
                'custom66',
                'description',
                'custom85',
                'custom47',
                'custom60',
                'custom126',
                'custom138',
                'tags',
                'custom117',
                'custom113',
                'custom128',
                'custom134',
                'custom133',
                'websiteUrl',
                'custom41',
                'custom135',
                'custom83',
                'custom77',
                'custom48',
                'custom148',
                'custom114',
                'custom145',
                'custom9',
                'custom110',
                'custom107',
                'custom139',
                'linkedInEmployees',
                'custom68',
                'custom105',
                'custom97',
                'foundedAt',
                'custom81',
                'externalSource',
                'custom71',
                'custom143',
                'custom27',
                'custom45',
                'custom79',
                'custom123',
                'custom101',
                'custom65',
                'custom31',
                'custom86',
                'custom36',
                'custom14',
                'custom140',
                'custom119',
                'custom62',
                'custom100',
                'custom144',
                'custom46',
                'custom93',
                'custom25',
                'custom16',
                'custom129',
                'custom18',
                'locality',
                'createdAt',
                'custom23',
                'creatorId',
                'custom98',
                'custom75',
                'custom30',
                'followers',
                'custom74',
                'custom55',
                'custom80',
                'custom64',
                'custom56',
                'custom13',
                'custom92',
                'custom109',
                'custom108',
                'linkedInUrl',
                'custom94',
                'custom73',
                'custom150',
                'custom84',
                'custom32',
                'custom82',
                'custom99',
                'custom115',
                'custom91',
                'custom34',
                'custom120',
                'custom141',
                'custom58',
                'custom102',
                'custom38',
                'named',
                'custom63',
                'custom118',
                'custom37',
                'custom22',
                'custom19',
                'custom52',
                'custom137',
                'custom6',
                'naturalName',
                'custom40',
                'custom54',
                'custom112',
                'custom146',
                'custom28',
                'domain',
                'custom127',
                'custom29',
                'custom42',
                'custom106',
                'custom125',
                'customId',
                'custom50',
                'custom21',
                'custom57',
                'custom72',
                'custom132',
                'custom44',
                'custom121',
                'custom87',
                'updaterId',
                'custom3',
                'custom5',
                'custom70',
                'custom1',
                'custom24',
                'custom149',
                'custom26',
                'custom20',
                'buyerIntentScore',
                'custom39',
                'custom33',
                'custom142',
                'custom2',
                'custom111',
                'custom43',
                'custom76',
                'custom90',
                'custom89',
                'custom51',
            },
            "events": {
                'externalUrl',
                'createdAt',
                'opportunityId',
                'userId',
                'name',
                'mailingId',
                'requestProxied',
                'requestDevice',
                'payload',
                'prospectId',
                'requestRegion',
                'accountId',
                'requestHost',
                'body',
                'taskId',
                'requestCity',
                'callId',
            },
            "calls": {
                'dialedAt',
                'vendorCallId',
                'returnedAt',
                'createdAt',
                'sequenceId',
                'from',
                'externalVendor',
                'callDispositionId',
                'note',
                'outcome',
                'uid',
                'prospectId',
                'state',
                'answeredAt',
                'shouldRecordCall',
                'voicemailRecordingUrl',
                'to',
                'phoneNumberId',
                'opportunityId',
                'userId',
                'sequenceAction',
                'recordingUrl',
                'completedAt',
                'userCallType',
                'direction',
                'stateChangedAt',
                'callPurposeId',
                'sequenceStepId',
                'taskId',
                'tags',
                'sequenceStateId',
            },
            "call_purposes": {
                'createdAt',
                'name',
                'order',
                'creatorId',
            },
            "sequence_steps": {
                'neutralReplyCount',
                'taskAutoskipDelay',
                'updaterId',
                'date',
                'replyCount',
                'createdAt',
                'stepType',
                'sequenceId',
                'order',
                'scheduleCount',
                'optOutCount',
                'taskNote',
                'creatorId',
                'positiveReplyCount',
                'deliverCount',
                'clickCount',
                'callPurposeId',
                'displayName',
                'negativeReplyCount',
                'interval',
                'bounceCount',
                'openCount',
                'failureCount',
                'taskPriorityId',
            },
            "mailings": {'id', 'updatedAt'},
            "prospects": {
                'emailOptedOut',
                'custom35',
                'custom124',
                'custom78',
                'personaId',
                'custom122',
                'facebookUrl',
                'custom136',
                'custom116',
                'custom53',
                'custom11',
                'custom95',
                'custom131',
                'custom96',
                'specialties',
                'addressState',
                'custom147',
                'custom61',
                'custom15',
                'custom8',
                'custom130',
                'optedOut',
                'custom88',
                'linkedInId',
                'ownerId',
                'timeZone',
                'custom7',
                'touchedAt',
                'score',
                'sharingTeamId',
                'custom104',
                'custom103',
                'custom4',
                'githubUrl',
                'custom49',
                'custom12',
                'custom69',
                'title',
                'occupation',
                'workPhones',
                'custom17',
                'custom59',
                'custom10',
                'name',
                'custom67',
                'optedOutAt',
                'custom66',
                'contactHistogram',
                'voipPhones',
                'lastName',
                'linkedInConnections',
                'custom85',
                'custom47',
                'preferredContact',
                'custom60',
                'custom126',
                'school',
                'accountId',
                'custom138',
                'addressCity',
                'eventName',
                'timeZoneInferred',
                'tags',
                'custom117',
                'custom113',
                'custom128',
                'custom134',
                'custom133',
                'addressStreet',
                'custom41',
                'callsOptStatus',
                'degree',
                'custom135',
                'region',
                'custom83',
                'custom77',
                'custom48',
                'custom148',
                'personalNote1',
                'custom114',
                'custom145',
                'clickCount',
                'quoraUrl',
                'custom9',
                'custom110',
                'company',
                'custom107',
                'custom139',
                'custom68',
                'custom105',
                'custom97',
                'custom81',
                'externalSource',
                'custom71',
                'linkedInSlug',
                'custom143',
                'custom27',
                'custom45',
                'custom79',
                'custom123',
                'custom101',
                'custom65',
                'stageId',
                'custom31',
                'custom86',
                'custom36',
                'twitterUsername',
                'custom14',
                'custom140',
                'custom119',
                'custom62',
                'custom100',
                'custom144',
                'gender',
                'custom46',
                'addressZip',
                'custom93',
                'websiteUrl1',
                'custom16',
                'custom25',
                'callOptedOut',
                'availableAt',
                'custom129',
                'engagedAt',
                'custom18',
                'angelListUrl',
                'replyCount',
                'createdAt',
                'personalNote2',
                'stackOverflowUrl',
                'custom23',
                'creatorId',
                'custom98',
                'custom75',
                'custom30',
                'custom74',
                'custom55',
                'custom80',
                'custom64',
                'custom56',
                'custom13',
                'custom92',
                'custom109',
                'custom108',
                'emailsOptedAt',
                'stackOverflowId',
                'linkedInUrl',
                'custom94',
                'custom73',
                'custom150',
                'addedAt',
                'custom84',
                'custom32',
                'emails',
                'custom82',
                'custom99',
                'custom115',
                'websiteUrl2',
                'custom91',
                'custom34',
                'externalId',
                'nickname',
                'twitterUrl',
                'jobStartDate',
                'source',
                'custom120',
                'custom141',
                'otherPhones',
                'websiteUrl3',
                'custom102',
                'custom58',
                'custom38',
                'custom63',
                'custom118',
                'trashedAt',
                'custom37',
                'custom22',
                'openCount',
                'custom19',
                'custom52',
                'custom137',
                'custom6',
                'externalOwner',
                'custom40',
                'dateOfBirth',
                'custom54',
                'custom112',
                'campaignName',
                'callsOptedAt',
                'custom146',
                'custom28',
                'timeZoneIana',
                'custom127',
                'custom29',
                'custom42',
                'custom106',
                'custom125',
                'custom50',
                'custom21',
                'custom57',
                'custom72',
                'custom132',
                'custom44',
                'githubUsername',
                'custom121',
                'custom87',
                'updaterId',
                'custom3',
                'custom5',
                'custom70',
                'custom1',
                'custom24',
                'custom149',
                'addressStreet2',
                'engagedScore',
                'firstName',
                'addressCountry',
                'custom26',
                'homePhones',
                'custom20',
                'middleName',
                'custom39',
                'googlePlusUrl',
                'custom33',
                'mobilePhones',
                'custom142',
                'custom2',
                'emailsOptStatus',
                'graduationDate',
                'custom111',
                'custom43',
                'custom76',
                'custom90',
                'custom89',
                'custom51',
            },
            "stages": {
                'color',
                'updaterId',
                'createdAt',
                'name',
                'order',
                'creatorId',
            },
        }
        automatic_fields = {
            table: properties.get(self.PRIMARY_KEYS, set())
            | properties.get(self.REPLICATION_KEYS, set())
            for table, properties in self.expected_metadata().items()}
        if not stream:
            return automatic_fields
        return automatic_fields[stream] | MISSING_FIELDS[stream]
